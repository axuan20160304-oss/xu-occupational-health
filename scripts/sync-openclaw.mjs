#!/usr/bin/env node
/**
 * æ³•è§„å†…å®¹æ¨é€è„šæœ¬ â€” æ¼”ç¤ºå¦‚ä½•é€šè¿‡ API è‡ªåŠ¨æ›´æ–°ç½‘ç«™æ³•è§„
 *
 * ä½¿ç”¨åœºæ™¯ï¼š
 *   1. æ‰‹åŠ¨æ•´ç†æ³•è§„åæ‰¹é‡æ¨é€
 *   2. é…åˆ OpenClaw / NotebookLM ç­‰ AI å·¥å…·ç”Ÿæˆæ³•è§„æ‘˜è¦åæ¨é€
 *   3. å¯¹æ¥ç¬¬ä¸‰æ–¹æ³•è§„æ•°æ®æºï¼ˆå¦‚åŒ—å¤§æ³•å®ã€å›½åŠ¡é™¢å…¬æŠ¥ç­‰ï¼‰
 *
 * ç”¨æ³•ï¼š
 *   CONTENT_API_KEY=your-key node scripts/sync-openclaw.mjs
 *
 * ç¯å¢ƒå˜é‡ï¼š
 *   SITE_URL        - ç½‘ç«™åœ°å€ï¼ˆé»˜è®¤ http://localhost:3001ï¼‰
 *   CONTENT_API_KEY - ç½‘ç«™ API å¯†é’¥
 */

const SITE_URL = process.env.SITE_URL || "http://localhost:3001";
const API_KEY = process.env.CONTENT_API_KEY || "";

/**
 * ç¤ºä¾‹æ³•è§„æ•°æ® â€”â€” å®é™…ä½¿ç”¨æ—¶æ›¿æ¢ä¸ºä»æ•°æ®æºè·å–çš„å†…å®¹
 * ä½ å¯ä»¥é€šè¿‡ OpenClaw çš„ AI èƒ½åŠ›æ¥æ•´ç†å’Œç”Ÿæˆè¿™äº›æ•°æ®
 */
const SAMPLE_LAWS = [
  {
    title: "ç”¨äººå•ä½èŒä¸šå¥åº·ç›‘æŠ¤ç›‘ç£ç®¡ç†åŠæ³•ï¼ˆ2024ä¿®è®¢ï¼‰",
    summary: "å›½å®¶å«å¥å§”ä¿®è®¢å‘å¸ƒï¼Œæ˜ç¡®ç”¨äººå•ä½èŒä¸šå¥åº·ç›‘æŠ¤çš„ç»„ç»‡å®æ–½ã€æ¡£æ¡ˆç®¡ç†å’Œç›‘ç£æ£€æŸ¥è¦æ±‚ã€‚",
    category: "éƒ¨é—¨è§„ç« ",
    tags: ["èŒä¸šå¥åº·ç›‘æŠ¤", "ç”¨äººå•ä½", "å«å¥å§”"],
    date: "2024-12-01",
    source: "openclaw",
    content: `## æ¦‚è¿°

æœ¬åŠæ³•ç”±å›½å®¶å«ç”Ÿå¥åº·å§”å‘˜ä¼šä¿®è®¢å‘å¸ƒï¼Œè‡ª2024å¹´12æœˆ1æ—¥èµ·æ–½è¡Œã€‚

## ä¸»è¦å†…å®¹

### ç¬¬ä¸€ç«  æ€»åˆ™

æ˜ç¡®äº†ç”¨äººå•ä½èŒä¸šå¥åº·ç›‘æŠ¤çš„åŸºæœ¬è¦æ±‚å’Œé€‚ç”¨èŒƒå›´ã€‚

### ç¬¬äºŒç«  èŒä¸šå¥åº·æ£€æŸ¥

- ç”¨äººå•ä½åº”å½“ç»„ç»‡ä»äº‹æ¥è§¦èŒä¸šç—…å±å®³ä½œä¸šçš„åŠ³åŠ¨è€…è¿›è¡Œä¸Šå²—å‰ã€åœ¨å²—æœŸé—´å’Œç¦»å²—æ—¶çš„èŒä¸šå¥åº·æ£€æŸ¥
- èŒä¸šå¥åº·æ£€æŸ¥åº”å½“ç”±å–å¾—ç›¸åº”èµ„è´¨çš„åŒ»ç–—å«ç”Ÿæœºæ„æ‰¿æ‹…
- æ£€æŸ¥é¡¹ç›®å’Œå‘¨æœŸåº”å½“ç¬¦åˆ GBZ 188 ç­‰å›½å®¶æ ‡å‡†

### ç¬¬ä¸‰ç«  èŒä¸šå¥åº·ç›‘æŠ¤æ¡£æ¡ˆ

- ç”¨äººå•ä½åº”å½“ä¸ºåŠ³åŠ¨è€…å»ºç«‹èŒä¸šå¥åº·ç›‘æŠ¤æ¡£æ¡ˆ
- æ¡£æ¡ˆåº”å½“åŒ…æ‹¬åŠ³åŠ¨è€…çš„èŒä¸šå²ã€èŒä¸šç—…å±å®³æ¥è§¦å²ã€èŒä¸šå¥åº·æ£€æŸ¥ç»“æœç­‰

### ç¬¬å››ç«  ç›‘ç£æ£€æŸ¥

> å«ç”Ÿå¥åº·ä¸»ç®¡éƒ¨é—¨åº”å½“åŠ å¼ºå¯¹ç”¨äººå•ä½èŒä¸šå¥åº·ç›‘æŠ¤å·¥ä½œçš„ç›‘ç£æ£€æŸ¥ã€‚

## å®åŠ¡è¦ç‚¹

1. æ–°å‘˜å·¥ä¸Šå²—å‰å¿…é¡»å®ŒæˆèŒä¸šå¥åº·æ£€æŸ¥
2. åœ¨å²—æœŸé—´æ£€æŸ¥å‘¨æœŸæŒ‰ GBZ 188 æ‰§è¡Œ
3. ç¦»å²—æ—¶å¿…é¡»è¿›è¡Œç¦»å²—å¥åº·æ£€æŸ¥
4. æ£€æŸ¥è´¹ç”¨ç”±ç”¨äººå•ä½æ‰¿æ‹…`,
  },
  {
    title: "å·¥ä½œåœºæ‰€èŒä¸šå«ç”Ÿç®¡ç†è§„å®šï¼ˆ2025å¹´æ‰§è¡Œè¦ç‚¹ï¼‰",
    summary: "æ¢³ç†å·¥ä½œåœºæ‰€èŒä¸šå«ç”Ÿç®¡ç†çš„æ ¸å¿ƒè¦æ±‚ï¼ŒåŒ…æ‹¬å±å®³å› ç´ æ£€æµ‹ã€é˜²æŠ¤è®¾æ–½å’Œåº”æ€¥é¢„æ¡ˆã€‚",
    category: "æ ‡å‡†è§„èŒƒ",
    tags: ["èŒä¸šå«ç”Ÿ", "å·¥ä½œåœºæ‰€", "ç®¡ç†è§„å®š"],
    date: "2025-01-15",
    source: "openclaw",
    content: `## æ ¸å¿ƒè¦æ±‚

### ä¸€ã€èŒä¸šç—…å±å®³å› ç´ æ£€æµ‹

- ç”¨äººå•ä½åº”å½“å®šæœŸå¯¹å·¥ä½œåœºæ‰€è¿›è¡ŒèŒä¸šç—…å±å®³å› ç´ æ£€æµ‹
- æ£€æµ‹ç»“æœåº”å½“å­˜æ¡£å¹¶å‘åŠ³åŠ¨è€…å…¬å¸ƒ
- è¶…æ ‡æ—¶åº”å½“ç«‹å³é‡‡å–æ²»ç†æªæ–½

### äºŒã€èŒä¸šç—…é˜²æŠ¤è®¾æ–½

- æ–°å»ºã€æ”¹å»ºã€æ‰©å»ºé¡¹ç›®åº”å½“è¿›è¡ŒèŒä¸šç—…å±å®³é¢„è¯„ä»·
- é˜²æŠ¤è®¾æ–½åº”å½“ä¸ä¸»ä½“å·¥ç¨‹åŒæ—¶è®¾è®¡ã€åŒæ—¶æ–½å·¥ã€åŒæ—¶æŠ•å…¥ä½¿ç”¨
- å®šæœŸç»´æŠ¤å’Œæ£€æµ‹é˜²æŠ¤è®¾æ–½çš„æœ‰æ•ˆæ€§

### ä¸‰ã€ä¸ªäººé˜²æŠ¤ç”¨å“

- ä¸ºåŠ³åŠ¨è€…æä¾›ç¬¦åˆå›½å®¶æ ‡å‡†çš„ä¸ªäººé˜²æŠ¤ç”¨å“
- å»ºç«‹ä¸ªäººé˜²æŠ¤ç”¨å“å‘æ”¾å’Œä½¿ç”¨ç®¡ç†åˆ¶åº¦
- å®šæœŸåŸ¹è®­åŠ³åŠ¨è€…æ­£ç¡®ä½¿ç”¨é˜²æŠ¤ç”¨å“

### å››ã€åº”æ€¥é¢„æ¡ˆ

> ç”¨äººå•ä½åº”å½“åˆ¶å®šèŒä¸šç—…å±å®³äº‹æ•…åº”æ€¥æ•‘æ´é¢„æ¡ˆï¼Œå¹¶å®šæœŸç»„ç»‡æ¼”ç»ƒã€‚

## è¿è§„å¤„ç½š

1. æœªè¿›è¡ŒèŒä¸šç—…å±å®³å› ç´ æ£€æµ‹çš„ï¼Œè´£ä»¤é™æœŸæ”¹æ­£ï¼Œé€¾æœŸä¸æ”¹æ­£çš„å¤„ä»¥ç½šæ¬¾
2. æœªæä¾›é˜²æŠ¤è®¾æ–½æˆ–ä¸ªäººé˜²æŠ¤ç”¨å“çš„ï¼Œè´£ä»¤é™æœŸæ²»ç†
3. å‘ç”ŸèŒä¸šç—…å±å®³äº‹æ•…éšç’ä¸æŠ¥çš„ï¼Œä¾æ³•è¿½ç©¶è´£ä»»`,
  },
];

/**
 * æ¨é€æ³•è§„åˆ°ç½‘ç«™
 */
async function pushToSite(law) {
  const headers = { "Content-Type": "application/json" };
  if (API_KEY) headers["x-api-key"] = API_KEY;

  const res = await fetch(`${SITE_URL}/api/laws`, {
    method: "POST",
    headers,
    body: JSON.stringify(law),
  });

  const result = await res.json();
  return { status: res.status, ...result };
}

/**
 * ä¸»æµç¨‹
 */
async function main() {
  console.log("=== æ³•è§„å†…å®¹æ¨é€åˆ°ç½‘ç«™ ===\n");
  console.log(`ç½‘ç«™åœ°å€: ${SITE_URL}`);
  console.log(`API å¯†é’¥: ${API_KEY ? "å·²é…ç½®" : "âš ï¸ æœªé…ç½®"}`);
  console.log(`å¾…æ¨é€: ${SAMPLE_LAWS.length} æ¡æ³•è§„\n`);

  let pushed = 0;
  let errors = 0;

  for (const law of SAMPLE_LAWS) {
    console.log(`ğŸ“„ æ¨é€: ${law.title}`);

    try {
      const result = await pushToSite(law);
      if (result.success) {
        console.log(`   âœ… æˆåŠŸ â†’ slug: ${result.slug}`);
        pushed++;
      } else {
        console.log(`   âŒ å¤±è´¥: ${result.message || JSON.stringify(result)}`);
        errors++;
      }
    } catch (err) {
      console.log(`   âŒ é”™è¯¯: ${err.message}`);
      errors++;
    }
  }

  console.log("\n=== æ¨é€å®Œæˆ ===");
  console.log(`æˆåŠŸ: ${pushed} æ¡`);
  console.log(`å¤±è´¥: ${errors} æ¡`);

  if (pushed > 0) {
    console.log(`\nğŸŒ æŸ¥çœ‹æ³•è§„åˆ—è¡¨: ${SITE_URL}/laws`);
  }
}

main().catch((err) => {
  console.error("âŒ è„šæœ¬é”™è¯¯:", err.message);
  process.exit(1);
});
